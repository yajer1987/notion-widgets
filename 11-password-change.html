<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>11 - å¯†ç¢¼è®Šæ›´æµç¨‹</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&family=Source+Code+Pro:wght@400;500&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans TC',sans-serif;background:#fff;color:#1a1a1a;padding:40px;font-size:14px;line-height:1.6}
.container{max-width:860px;margin:0 auto}
h1{font-size:22px;font-weight:700;margin-bottom:4px}
.sub{font-size:13px;color:#666;font-family:'Source Code Pro',monospace;margin-bottom:32px}
code{font-family:'Source Code Pro',monospace;font-size:12px;background:#f5f5f5;padding:1px 5px;border-radius:3px;color:#d14}

.section{font-weight:700;font-size:15px;margin:28px 0 12px;padding-bottom:6px;border-bottom:2px solid #e5e5e5}

/* Comparison table */
.comp{width:100%;border-collapse:collapse;font-size:13px;margin-bottom:24px}
.comp th{text-align:left;padding:8px 10px;border-bottom:2px solid #d1d5db;font-weight:600;color:#666;font-size:12px}
.comp td{padding:8px 10px;border-bottom:1px solid #e5e5e5;vertical-align:top}
.comp tr:last-child td{border-bottom:none}

/* Two columns */
.two{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px}
.box{border:1px solid #e5e5e5;border-radius:8px;overflow:hidden}
.box-h{padding:10px 14px;font-weight:700;font-size:14px;border-bottom:1px solid #e5e5e5;background:#f9fafb}
.box-b{padding:14px}

.json{background:#f8fafc;border:1px solid #e2e8f0;border-radius:4px;padding:8px 12px;font-family:'Source Code Pro',monospace;font-size:11px;line-height:1.6;color:#555;margin-bottom:10px}
.json .k{color:#0550ae}.json .v{color:#116329}.json .c{color:#999}

.steps{display:flex;flex-direction:column;gap:6px}
.s{display:flex;gap:10px;align-items:flex-start;padding:10px 14px;border:1px solid #e5e5e5;border-radius:6px;font-size:13px}
.s-n{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;flex-shrink:0;color:#fff}
.n-blue{background:#4a7fd4}.n-gray{background:#888}.n-green{background:#3a9a5c}.n-red{background:#c0392b}.n-orange{background:#d97706}
.s-ok{background:#f0fdf4;border-color:#86efac}

.note{margin-top:24px;padding:14px 16px;border:1px solid #d1d5db;border-radius:6px;font-size:13px;color:#444;background:#f9fafb;line-height:1.7}
.note b{color:#1a1a1a}
.note-warn{background:#fffbeb;border-color:#fde68a}
.wm{text-align:center;margin-top:24px;font-size:11px;color:#bbb;font-family:'Source Code Pro',monospace}
</style>
</head>
<body>
<div class="container">
  <h1>11 â€” å¯†ç¢¼è®Šæ›´æµç¨‹</h1>
  <div class="sub">Self ä¿®æ”¹ vs Admin å¼·åˆ¶é‡è¨­ Â· åªé©ç”¨æ–¼ local å¸³è™Ÿ</div>

  <div class="section">å…©ç¨®æ©Ÿåˆ¶æ¯”è¼ƒ</div>
  <table class="comp">
    <tr><th style="width:130px">é …ç›®</th><th>Self ä¿®æ”¹å¯†ç¢¼</th><th>Admin å¼·åˆ¶é‡è¨­</th></tr>
    <tr><td><b>API</b></td><td><code>POST /accounts/{id}/actions/change-password</code></td><td><code>PATCH /accounts/{id}</code></td></tr>
    <tr><td><b>è§¸ç™¼è€…</b></td><td>ä½¿ç”¨è€…è‡ªå·±ï¼ˆSelf-actionï¼‰</td><td>ç®¡ç†è€…ï¼ˆéœ€ auth:accounts:writeï¼‰</td></tr>
    <tr><td><b>éœ€è¦èˆŠå¯†ç¢¼</b></td><td style="color:#166534">âœ“ å¿…é ˆæä¾›</td><td style="color:#991b1b">âœ— ä¸éœ€è¦</td></tr>
    <tr><td><b>Request</b></td><td>{currentPassword, newPassword}</td><td>{password, passwordChangeRequired: true}</td></tr>
    <tr><td><b>æ—¢æœ‰ Session</b></td><td>ä¿ç•™ä¸å½±éŸ¿</td><td>å…¨éƒ¨åˆªé™¤ï¼ˆå¼·åˆ¶é‡æ–°ç™»å…¥ï¼‰</td></tr>
    <tr><td><b>å ´æ™¯</b></td><td>å®šæœŸæ›´æ›ã€è¦ºå¾—ä¸å®‰å…¨</td><td>å“¡å·¥å¿˜è¨˜å¯†ç¢¼ã€å¸³è™Ÿè¢«ç›œ</td></tr>
  </table>

  <div class="two">
    <div class="box">
      <div class="box-h">ğŸ‘¤ ä½¿ç”¨è€…è‡ªå·±æ”¹å¯†ç¢¼</div>
      <div class="box-b">
        <div class="json">POST /accounts/{myId}/actions/change-password
{<span class="k">"currentPassword"</span>:<span class="v">"Old"</span>, <span class="k">"newPassword"</span>:<span class="v">"New"</span>}</div>
        <div class="steps">
          <div class="s"><div class="s-n n-blue">1</div><div>JWT.sub == URL.accountId â†’ Self å…è¨±</div></div>
          <div class="s"><div class="s-n n-gray">2</div><div>é©—è­‰ currentPassword æ­£ç¢º</div></div>
          <div class="s"><div class="s-n n-gray">3</div><div>é©—è­‰ newPassword ç¬¦åˆ policy</div></div>
          <div class="s"><div class="s-n n-gray">4</div><div>æ›´æ–° hashï¼Œè¨­ passwordChangeRequired: false</div></div>
          <div class="s s-ok"><div class="s-n n-green">5</div><div><b>200</b> å®Œæˆï¼Œç¾æœ‰ Session ä¸å—å½±éŸ¿</div></div>
        </div>
      </div>
    </div>
    <div class="box">
      <div class="box-h">ğŸ”‘ Admin å¼·åˆ¶é‡è¨­</div>
      <div class="box-b">
        <div class="json">PATCH /accounts/{targetId}
{<span class="k">"password"</span>:<span class="v">"Temp"</span>, <span class="k">"passwordChangeRequired"</span>: true}</div>
        <div class="steps">
          <div class="s"><div class="s-n n-blue">1</div><div>JWT.sub â‰  URL â†’ æª¢æŸ¥ auth:accounts:write</div></div>
          <div class="s"><div class="s-n n-gray">2</div><div>é©—è­‰æ–°å¯†ç¢¼ç¬¦åˆ policy</div></div>
          <div class="s"><div class="s-n n-gray">3</div><div>æ›´æ–° hash + è¨­ passwordChangeRequired: true</div></div>
          <div class="s" style="background:#fef2f2;border-color:#fca5a5"><div class="s-n n-red">4</div><div><b>åˆªé™¤ç›®æ¨™å¸³è™Ÿæ‰€æœ‰ Session</b>ï¼ˆå¼·åˆ¶ç™»å‡ºï¼‰</div></div>
          <div class="s s-ok"><div class="s-n n-green">5</div><div><b>200</b> é‡è¨­å®Œæˆ</div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="section">å®Œæ•´å ´æ™¯ï¼šé¦–æ¬¡ç™»å…¥è¢«è¦æ±‚æ”¹å¯†ç¢¼</div>
  <div class="steps">
    <div class="s"><div class="s-n n-orange">1</div><div>ç®¡ç†è€…å»ºå¸³æ™‚è¨­ passwordChangeRequired: true + è‡¨æ™‚å¯†ç¢¼</div></div>
    <div class="s"><div class="s-n n-blue">2</div><div>ä½¿ç”¨è€…ç”¨è‡¨æ™‚å¯†ç¢¼ POST /tokens â†’ <b>ç™»å…¥æˆåŠŸ</b>ï¼Œå–å¾— JWT</div></div>
    <div class="s" style="background:#fffbeb;border-color:#fde68a"><div class="s-n n-orange">3</div><div>å›æ‡‰ä¸­ passwordChangeRequired: true â†’ å‰ç«¯å°å‘ä¿®æ”¹å¯†ç¢¼é ï¼ˆä¸æ˜¯ 403ï¼Œä½¿ç”¨è€…æ‹¿åˆ°äº†åˆæ³• JWTï¼‰</div></div>
    <div class="s"><div class="s-n n-blue">4</div><div>ä½¿ç”¨è€…è¼¸å…¥æ–°å¯†ç¢¼ â†’ POST /accounts/{id}/actions/change-password (currentPassword = è‡¨æ™‚å¯†ç¢¼)</div></div>
    <div class="s"><div class="s-n n-gray">5</div><div>æ›´æ–°å¯†ç¢¼ + è¨­ passwordChangeRequired: false</div></div>
    <div class="s s-ok"><div class="s-n n-green">6</div><div>å‰ç«¯å°å‘é¦–é ï¼Œæ­£å¸¸ä½¿ç”¨</div></div>
  </div>

  <div class="note note-warn">
    <b>ç‚ºä»€éº¼ passwordChangeRequired ä¸é˜»æ“‹ç™»å…¥ï¼Ÿ</b>ä½¿ç”¨è€…éœ€è¦åˆæ³•çš„ JWT æ‰èƒ½å‘¼å« change-password APIï¼ˆSelf-action éœ€è¦ JWT.subï¼‰ã€‚å¦‚æœé˜»æ“‹ç™»å…¥ï¼Œä½¿ç”¨è€…æ²’æœ‰ JWT â†’ ç„¡æ³•å‘¼å«ä»»ä½• API â†’ æ­»é–ã€‚æ‰€ä»¥è¨­è¨ˆæ˜¯ã€Œç™»å…¥æˆåŠŸ + å›å‚³ flagã€ï¼Œç”±å‰ç«¯é™åˆ¶æ“ä½œç¯„åœã€‚
  </div>
  <div class="wm">Auth Service v3.2 Â· Password Change Flow</div>
</div>
</body>
</html>
